<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Macro calls every modifier function by passing self and the code of function’s body. It means that modifiers must be available in the scope of the marked method."><title>modifiers in openbrush_lang - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Bold-a2c9cd1067f8b328.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-1def573a4779b29b.css" id="mainThemeStyle"><link rel="stylesheet" id="themeStyle" href="../static.files/light-d59023bfa12059d2.css"><link rel="stylesheet" disabled href="../static.files/dark-1ca41bb1e10af075.css"><link rel="stylesheet" disabled href="../static.files/ayu-18b4181a2f3fb862.css"><script src="../static.files/storage-3891ce972e3a2bf8.js"></script><script defer src="sidebar-items.js"></script><script defer src="../static.files/main-98a684e84ae5b08b.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-13285aec31fa243e.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc attr"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="logo-container" href="../openbrush_lang/index.html"><img class="rust-logo" src="../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2></h2></nav><nav class="sidebar"><a class="logo-container" href="../openbrush_lang/index.html"><img class="rust-logo" src="../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><div class="sidebar-elems"><h2><a href="index.html">In openbrush_lang</a></h2></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Attribute Macro <a href="index.html">openbrush_lang</a>::<wbr><a class="attr" href="#">modifiers</a><button id="copy-path" title="Copy item path to clipboard"><img src="../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="srclink" href="../src/openbrush_lang_macro/lib.rs.html#358">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><pre class="rust item-decl"><code>#[modifiers]</code></pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Macro calls every modifier function by passing self and the code of function’s body.
It means that modifiers must be available in the scope of the marked method.</p>
<p>Modifiers are designed to be used for methods in impl sections.
The method can have several modifiers. They will be expanded from left to right.
The modifier can accept arguments from the scope of the method definition
(you can pass an argument from the signature of marked method or from the outside scope of function).
The modifier accepts arguments only by value and the type of argument must support <code>Clone</code> trait,
because macro will clone the argument and will pass it to the modifier.</p>
<h2 id="explanation"><a href="#explanation">Explanation:</a></h2>
<p>Let’s define next modifiers.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="attr">#[openbrush::modifier_definition]
</span><span class="kw">fn </span>A&lt;T&gt;(instance: <span class="kw-2">&amp;</span>T, body: <span class="kw">impl </span>FnOnce(<span class="kw-2">&amp;</span>T) -&gt; <span class="kw-2">&amp;</span><span class="lifetime">&#39;static </span>str) -&gt; <span class="kw-2">&amp;</span><span class="lifetime">&#39;static </span>str {
    <span class="macro">println!</span>(<span class="string">&quot;A before&quot;</span>);
    <span class="kw">let </span>result = body(instance);
    <span class="macro">println!</span>(<span class="string">&quot;A after&quot;</span>);
    result
}

<span class="attr">#[openbrush::modifier_definition]
</span><span class="kw">fn </span>B&lt;T, F: FnOnce(<span class="kw-2">&amp;</span>T) -&gt; <span class="kw-2">&amp;</span><span class="lifetime">&#39;static </span>str&gt;(instance: <span class="kw-2">&amp;</span>T, body: F, data1: u8, data2: u8) -&gt; <span class="kw-2">&amp;</span><span class="lifetime">&#39;static </span>str {
    <span class="macro">println!</span>(<span class="string">&quot;B before {} {}&quot;</span>, data1, data2);
    <span class="kw">let </span>result = body(instance);
    <span class="macro">println!</span>(<span class="string">&quot;B after {} {}&quot;</span>, data1, data2);
    result
}

<span class="attr">#[openbrush::modifier_definition]
</span><span class="kw">fn </span>C&lt;T, F&gt;(instance: <span class="kw-2">&amp;</span>T, body: F) -&gt; <span class="kw-2">&amp;</span><span class="lifetime">&#39;static </span>str
    <span class="kw">where </span>F: FnOnce(<span class="kw-2">&amp;</span>T) -&gt; <span class="kw-2">&amp;</span><span class="lifetime">&#39;static </span>str
{
    <span class="macro">println!</span>(<span class="string">&quot;C before&quot;</span>);
    <span class="kw">let </span>result = body(instance);
    <span class="macro">println!</span>(<span class="string">&quot;C after&quot;</span>);
    result
}

<span class="kw">struct </span>Contract {}

<span class="kw">impl </span>Contract {
    <span class="attr">#[openbrush::modifiers(A, B(_data, <span class="number">13</span>), C)]
    </span><span class="kw">fn </span>main_logic(<span class="kw-2">&amp;</span><span class="self">self</span>, _data: u8) -&gt; <span class="kw-2">&amp;</span><span class="lifetime">&#39;static </span>str {
        <span class="kw">return </span><span class="string">&quot;Return value&quot;</span>;
    }
}</code></pre></div>
<p>The code above will be expanded into:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="attr">#[openbrush::modifier_definition]
</span><span class="kw">fn </span>A&lt;T&gt;(instance: <span class="kw-2">&amp;</span>T, body: <span class="kw">impl </span>FnOnce(<span class="kw-2">&amp;</span>T) -&gt; <span class="kw-2">&amp;</span><span class="lifetime">&#39;static </span>str) -&gt; <span class="kw-2">&amp;</span><span class="lifetime">&#39;static </span>str {
    <span class="macro">println!</span>(<span class="string">&quot;A before&quot;</span>);
    <span class="kw">let </span>result = body(instance);
    <span class="macro">println!</span>(<span class="string">&quot;A after&quot;</span>);
    result
}

<span class="attr">#[openbrush::modifier_definition]
</span><span class="kw">fn </span>B&lt;T, F: FnOnce(<span class="kw-2">&amp;</span>T) -&gt; <span class="kw-2">&amp;</span><span class="lifetime">&#39;static </span>str&gt;(instance: <span class="kw-2">&amp;</span>T, body: F, data1: u8, data2: u8) -&gt; <span class="kw-2">&amp;</span><span class="lifetime">&#39;static </span>str {
    <span class="macro">println!</span>(<span class="string">&quot;B before {} {}&quot;</span>, data1, data2);
    <span class="kw">let </span>result = body(instance);
    <span class="macro">println!</span>(<span class="string">&quot;B after {} {}&quot;</span>, data1, data2);
    result
}

<span class="attr">#[openbrush::modifier_definition]
</span><span class="kw">fn </span>C&lt;T, F&gt;(instance: <span class="kw-2">&amp;</span>T, body: F) -&gt; <span class="kw-2">&amp;</span><span class="lifetime">&#39;static </span>str
    <span class="kw">where </span>F: FnOnce(<span class="kw-2">&amp;</span>T) -&gt; <span class="kw-2">&amp;</span><span class="lifetime">&#39;static </span>str
{
    <span class="macro">println!</span>(<span class="string">&quot;C before&quot;</span>);
    <span class="kw">let </span>result = body(instance);
    <span class="macro">println!</span>(<span class="string">&quot;C after&quot;</span>);
    result
}

<span class="kw">struct </span>Contract {}

<span class="kw">impl </span>Contract {
    <span class="kw">fn </span>main_logic(<span class="kw-2">&amp;</span><span class="self">self</span>, _data: u8) -&gt; <span class="kw-2">&amp;</span><span class="lifetime">&#39;static </span>str {
        <span class="kw">let </span><span class="kw-2">mut </span>__openbrush_body_2 = |__openbrush_instance_modifier: <span class="kw-2">&amp;</span><span class="self">Self</span>| {
            <span class="kw">let </span>__openbrush_cloned_0 = _data.clone();
            <span class="kw">let </span>__openbrush_cloned_1 = <span class="number">13</span>.clone();
            <span class="kw">let </span><span class="kw-2">mut </span>__openbrush_body_1 = |__openbrush_instance_modifier: <span class="kw-2">&amp;</span><span class="self">Self</span>| {
                <span class="kw">let </span><span class="kw-2">mut </span>__openbrush_body_0 = |__openbrush_instance_modifier: <span class="kw-2">&amp;</span><span class="self">Self</span>| <span class="kw">return </span><span class="string">&quot;Return value&quot;</span>;;
                C(__openbrush_instance_modifier, __openbrush_body_0)
            };
            B(__openbrush_instance_modifier, __openbrush_body_1, __openbrush_cloned_0, __openbrush_cloned_1)
        };
        A(<span class="self">self</span>, __openbrush_body_2)
    }
}</code></pre></div>
<h2 id="example-usage"><a href="#example-usage">Example: Usage</a></h2>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="attr">#[openbrush::contract]
</span><span class="kw">mod </span>example {
    <span class="attr">#[ink(storage)]
    </span><span class="kw">pub struct </span>Contract {
        initialized: bool,
        owner: AccountId,
    }

    <span class="kw">impl </span>Default <span class="kw">for </span>Contract {
        <span class="kw">fn </span>default() -&gt; <span class="self">Self </span>{
            <span class="self">Self </span>{
                initialized: <span class="bool-val">false</span>,
                owner: [<span class="number">0u8</span>; <span class="number">32</span>].into(),
            }
        }
    }

    <span class="attr">#[openbrush::modifier_definition]
    </span><span class="kw">fn </span>once(instance: <span class="kw-2">&amp;mut </span>Contract, body: <span class="kw">impl </span>FnOnce(<span class="kw-2">&amp;mut </span>Contract)) {
        <span class="macro">assert!</span>(!instance.initialized, <span class="string">&quot;Contract is already initialized&quot;</span>);
        body(instance);
        instance.initialized = <span class="bool-val">true</span>;
    }

    <span class="kw">impl </span>Contract {
        <span class="attr">#[ink(constructor)]
        </span><span class="kw">pub fn </span>new() -&gt; <span class="self">Self </span>{
            <span class="self">Self</span>::default()
        }

        <span class="attr">#[ink(message)]
        #[openbrush::modifiers(once)]
        </span><span class="kw">pub fn </span>init(<span class="kw-2">&amp;mut </span><span class="self">self</span>, owner: AccountId) {
            <span class="self">self</span>.owner = owner;
        }
    }
}</code></pre></div>
</div></details></section></div></main><div id="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="openbrush_lang" data-themes="" data-resource-suffix="" data-rustdoc-version="1.69.0-nightly (4507fdaaa 2023-02-18)" data-search-js="search-14421e1532aead08.js" data-settings-js="settings-f0c5c39777a9a2f6.js" data-settings-css="settings-0bcba95ff279c1db.css" ></div></body></html>